<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡å‹è®­ç»ƒ - å›¾åƒè¯†åˆ«å¤§è¯¾è®¾</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background-color: #f8f9fa;
        }
        .section-title {
            margin-bottom: 30px;
            color: #343a40;
            font-weight: 600;
        }
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .btn-primary {
            background-color: #667eea;
            border-color: #667eea;
        }
        .btn-primary:hover {
            background-color: #5a67d8;
            border-color: #5a67d8;
        }
        .btn-secondary {
            background-color: #48bb78;
            border-color: #48bb78;
        }
        .btn-secondary:hover {
            background-color: #38a169;
            border-color: #38a169;
        }
        .param-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }
        .param-label {
            font-weight: 500;
            color: #495057;
        }
        .param-value {
            font-weight: 600;
            color: #667eea;
        }
        .training-info {
            margin-top: 30px;
        }
        .training-status {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 20px;
        }
        .status-pending {
            color: #ffc107;
        }
        .status-training {
            color: #17a2b8;
        }
        .status-completed {
            color: #28a745;
        }
        .status-error {
            color: #dc3545;
        }
        .progress-container {
            margin: 20px 0;
        }
        .logs-container {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9rem;
        }
        .log-line {
            margin-bottom: 5px;
        }
        .log-info {
            color: #63b3ed;
        }
        .log-success {
            color: #68d391;
        }
        .log-warning {
            color: #fbbf24;
        }
        .log-error {
            color: #fc8181;
        }
        .training-stats {
            margin-top: 20px;
        }
        .stat-item {
            text-align: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #667eea;
        }
        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">å›¾åƒè¯†åˆ«å¤§è¯¾è®¾</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/">é¦–é¡µ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/prepare_data">æ•°æ®å‡†å¤‡</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/config">æ¨¡å‹é…ç½®</a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="/train">æ¨¡å‹è®­ç»ƒ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/results">è®­ç»ƒç»“æœ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/predict">å›¾åƒé¢„æµ‹</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <h1 class="section-title">æ¨¡å‹è®­ç»ƒ</h1>
        
        <!-- è®­ç»ƒå‚æ•°æ¦‚è§ˆ -->
        <div class="card">
            <div class="card-body">
                <h3>è®­ç»ƒå‚æ•°</h3>
                <div class="mt-3" id="params-container">
                    <div class="param-item">
                        <span class="param-label">æ¨¡å‹ç±»å‹ï¼š</span>
                        <span class="param-value" id="model-type">-</span>
                    </div>
                    <div class="param-item">
                        <span class="param-label">æ‰¹æ¬¡å¤§å°ï¼š</span>
                        <span class="param-value" id="batch-size">-</span>
                    </div>
                    <div class="param-item">
                        <span class="param-label">å­¦ä¹ ç‡ï¼š</span>
                        <span class="param-value" id="learning-rate">-</span>
                    </div>
                    <div class="param-item">
                        <span class="param-label">è®­ç»ƒè½®æ•°ï¼š</span>
                        <span class="param-value" id="epochs">-</span>
                    </div>
                    <div class="param-item">
                        <span class="param-label">ä¼˜åŒ–å™¨ï¼š</span>
                        <span class="param-value" id="optimizer-type">-</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- è®­ç»ƒæ§åˆ¶ -->
        <div class="card">
            <div class="card-body">
                <h3>å¼€å§‹è®­ç»ƒ</h3>
                <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹è®­ç»ƒæ¨¡å‹ã€‚è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ‚¨å¯ä»¥å®æ—¶æŸ¥çœ‹è®­ç»ƒæ—¥å¿—å’Œè¿›åº¦ã€‚</p>
                <p><strong>æ³¨æ„ï¼š</strong> è®­ç»ƒæ—¶é—´å–å†³äºæ¨¡å‹å¤æ‚åº¦ã€æ•°æ®é›†å¤§å°å’Œç¡¬ä»¶æ€§èƒ½ã€‚ç®€å•æ¨¡å‹é€šå¸¸éœ€è¦å‡ åˆ†é’Ÿï¼Œè€Œå¤æ‚æ¨¡å‹å¯èƒ½éœ€è¦æ›´é•¿æ—¶é—´ã€‚</p>
                
                <form action="/train" method="post" id="training-form">
                    <button type="submit" class="btn btn-primary btn-lg" id="start-training-btn">
                        ğŸš€ å¼€å§‹è®­ç»ƒ
                    </button>
                    <button type="button" class="btn btn-secondary btn-lg ml-3" id="view-results-btn" style="display: none;">
                        ğŸ“Š æŸ¥çœ‹ç»“æœ
                    </button>
                    <button type="button" class="btn btn-primary btn-lg ml-3" id="retrain-btn" style="display: none;">
                        ğŸ”„ é‡æ–°è®­ç»ƒ
                    </button>
                    <button type="button" class="btn btn-danger btn-lg ml-3" id="stop-training-btn" style="display: none;">
                    â¹ï¸ åœæ­¢è®­ç»ƒ
                </button>
                
                <!-- åœæ­¢è®­ç»ƒåçš„é€‰é¡¹æŒ‰é’®ç»„ -->
                <div id="stop-options" class="btn-group mt-2" style="display: none;">
                    <button id="resume-training-btn" class="btn btn-primary">ç»§ç»­è®­ç»ƒ</button>
                    <button id="back-to-config-btn" class="btn btn-secondary">è¿”å›é…ç½®</button>
                    <button id="terminate-training-btn" class="btn btn-danger">ç»ˆæ­¢è®­ç»ƒ</button>
                </div>
                </form>
            </div>
        </div>
        
        <!-- è®­ç»ƒçŠ¶æ€ -->
        <div class="card training-info">
            <div class="card-body">
                <h3>è®­ç»ƒçŠ¶æ€</h3>
                
                <div class="training-status status-pending" id="training-status">
                    â³ ç­‰å¾…å¼€å§‹è®­ç»ƒ...
                </div>
                
                <!-- è¿›åº¦æ¡ -->
                <div class="progress-container">
                    <div class="progress">
                        <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
                    </div>
                </div>
                
                <!-- å½“å‰è½®æ¬¡ä¿¡æ¯ -->
                <div class="training-stats">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="stat-item">
                                <div class="stat-value" id="current-epoch">0</div>
                                <div class="stat-label">å½“å‰è½®æ¬¡</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-item">
                                <div class="stat-value" id="train-loss">0.0000</div>
                                <div class="stat-label">è®­ç»ƒæŸå¤±</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-item">
                                <div class="stat-value" id="train-acc">0.00%</div>
                                <div class="stat-label">è®­ç»ƒå‡†ç¡®ç‡</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-item">
                                <div class="stat-value" id="test-acc">0.00%</div>
                                <div class="stat-label">æµ‹è¯•å‡†ç¡®ç‡</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- è®­ç»ƒæ—¥å¿— -->
                <div class="mt-4">
                    <h4>è®­ç»ƒæ—¥å¿—</h4>
                    <div class="logs-container" id="training-logs">
                        <div class="log-line"><span class="log-info">[ä¿¡æ¯]</span> å‡†å¤‡å¼€å§‹è®­ç»ƒ...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- è®­ç»ƒæç¤º -->
        <div class="card">
            <div class="card-body">
                <h3>è®­ç»ƒæç¤º</h3>
                <ul>
                    <li>è®­ç»ƒè¿‡ç¨‹ä¸­è¯·ä¸è¦å…³é—­æµè§ˆå™¨çª—å£ï¼Œå¦åˆ™è®­ç»ƒå°†ä¸­æ–­</li>
                    <li>æ‚¨å¯ä»¥é€šè¿‡è§‚å¯ŸæŸå¤±å€¼å’Œå‡†ç¡®ç‡çš„å˜åŒ–æ¥åˆ¤æ–­è®­ç»ƒæ•ˆæœ</li>
                    <li>å¦‚æœæŸå¤±å€¼æŒç»­ä¸‹é™ä½†å‡†ç¡®ç‡ä¸å†æé«˜ï¼Œå¯èƒ½å‡ºç°äº†è¿‡æ‹Ÿåˆ</li>
                    <li>å¦‚æœæŸå¤±å€¼æ³¢åŠ¨å¾ˆå¤§ï¼Œå¯èƒ½æ˜¯å­¦ä¹ ç‡è®¾ç½®è¿‡å¤§</li>
                    <li>è®­ç»ƒå®Œæˆåï¼Œæ‚¨å¯ä»¥åœ¨ç»“æœé¡µé¢æŸ¥çœ‹è¯¦ç»†çš„è®­ç»ƒæŠ¥å‘Š</li>
                </ul>
            </div>
        </div>
    </div>

    <footer class="mt-10 py-5 bg-dark text-white">
        <div class="container text-center">
            <p>&copy; 2023 å›¾åƒè¯†åˆ«å¤§è¯¾è®¾ - æ·±åº¦å­¦ä¹ é¡¹ç›®</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // è·å–DOMå…ƒç´ 
            const trainingForm = document.getElementById('training-form');
            const startTrainingBtn = document.getElementById('start-training-btn');
            const viewResultsBtn = document.getElementById('view-results-btn');
            const retrainBtn = document.getElementById('retrain-btn');
            const stopTrainingBtn = document.getElementById('stop-training-btn');
            const trainingStatus = document.getElementById('training-status');
            const progressBar = document.getElementById('progress-bar');
            const trainingLogs = document.getElementById('training-logs');
            const currentEpoch = document.getElementById('current-epoch');
            const trainLoss = document.getElementById('train-loss');
            const trainAcc = document.getElementById('train-acc');
            const testAcc = document.getElementById('test-acc');
            const stopOptions = document.getElementById('stop-options');
            const resumeTrainingBtn = document.getElementById('resume-training-btn');
            const backToConfigBtn = document.getElementById('back-to-config-btn');
            const terminateTrainingBtn = document.getElementById('terminate-training-btn');
            
            // å‚æ•°å…ƒç´ 
            const modelTypeElement = document.getElementById('model-type');
            const batchSizeElement = document.getElementById('batch-size');
            const learningRateElement = document.getElementById('learning-rate');
            const epochsElement = document.getElementById('epochs');
            const optimizerTypeElement = document.getElementById('optimizer-type');
            
            // é»˜è®¤è®­ç»ƒå‚æ•°
    let trainingParams = {
        model_type: 'simple',
        batch_size: 64,
        learning_rate: 0.001,
        epochs: 500,
        optimizer_type: 'adam'
    };
            
            // ä»åç«¯APIè·å–å®é™…æ¨¡å‹å‚æ•°
            function loadModelParams() {
                // é¦–å…ˆå°è¯•ä»URLå‚æ•°è·å–é…ç½®ï¼ˆå…¼å®¹ç°æœ‰é€»è¾‘ï¼‰
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.get('model_type')) {
                    const modelType = urlParams.get('model_type');
                    const batchSize = urlParams.get('batch_size');
                    const learningRate = urlParams.get('learning_rate');
                    const epochs = urlParams.get('epochs');
                    const optimizerType = urlParams.get('optimizer_type');
                    
                    // æ›´æ–°è®­ç»ƒå‚æ•°
                    if (modelType) trainingParams.model_type = modelType;
                    if (batchSize) trainingParams.batch_size = parseInt(batchSize);
                    if (learningRate) trainingParams.learning_rate = parseFloat(learningRate);
                    if (epochs) trainingParams.epochs = parseInt(epochs);
                    if (optimizerType) trainingParams.optimizer_type = optimizerType;
                }
                
                // ç„¶åå°è¯•ä»model_params.jsonåŠ è½½æœ€æ–°å‚æ•°
                fetch('static/model_params.json')
                    .then(response => {
                        if (response.ok) {
                            return response.json();
                        }
                        throw new Error('å‚æ•°æ–‡ä»¶ä¸å­˜åœ¨æˆ–æ— æ³•è®¿é—®');
                    })
                    .then(data => {
                        // æ›´æ–°è®­ç»ƒå‚æ•°ä¸ºä»æ–‡ä»¶åŠ è½½çš„å‚æ•°
                        if (data) {
                            trainingParams = {
                                model_type: data.model_type || 'simple',
                                batch_size: data.batch_size || 64,
                                learning_rate: data.learning_rate || 0.001,
                                epochs: data.epochs || 10,
                                optimizer_type: data.optimizer_type || 'adam'
                            };
                        }
                        // æ˜¾ç¤ºå‚æ•°
                        updateParamDisplay();
                    })
                    .catch(error => {
                        console.log('æ— æ³•åŠ è½½å‚æ•°æ–‡ä»¶ï¼Œä½¿ç”¨é»˜è®¤å€¼æˆ–URLå‚æ•°:', error);
                        // æ˜¾ç¤ºå‚æ•°ï¼ˆä½¿ç”¨é»˜è®¤å€¼æˆ–URLå‚æ•°ï¼‰
                        updateParamDisplay();
                    });
            }
            
            // æ›´æ–°å‚æ•°æ˜¾ç¤º
            function updateParamDisplay() {
                // æ˜¾ç¤ºæ¨¡å‹ç±»å‹
                let modelTypeName = 'ç®€å•CNN';
                if (trainingParams.model_type === 'improved') {
                    modelTypeName = 'æ”¹è¿›CNN';
                } else if (trainingParams.model_type === 'advanced') {
                    modelTypeName = 'é«˜çº§CNN';
                }
                modelTypeElement.textContent = modelTypeName;
                
                // æ˜¾ç¤ºå…¶ä»–å‚æ•°
                batchSizeElement.textContent = trainingParams.batch_size;
                learningRateElement.textContent = trainingParams.learning_rate;
                epochsElement.textContent = trainingParams.epochs;
                optimizerTypeElement.textContent = trainingParams.optimizer_type === 'adam' ? 'Adam' : 'SGD';
            }
            
            // åˆå§‹åŠ è½½å‚æ•°
            loadModelParams();
            
            // æ·»åŠ æ—¥å¿—çš„å‡½æ•°
            function addLog(type, message) {
                const logLine = document.createElement('div');
                logLine.className = 'log-line';
                
                let logClass = 'log-info';
                let logTypeName = 'ä¿¡æ¯';
                
                switch(type) {
                    case 'success':
                        logClass = 'log-success';
                        logTypeName = 'æˆåŠŸ';
                        break;
                    case 'warning':
                        logClass = 'log-warning';
                        logTypeName = 'è­¦å‘Š';
                        break;
                    case 'error':
                        logClass = 'log-error';
                        logTypeName = 'é”™è¯¯';
                        break;
                }
                
                logLine.innerHTML = `<span class="${logClass}">[${logTypeName}]</span> ${message}`;
                trainingLogs.appendChild(logLine);
                
                // æ»šåŠ¨åˆ°åº•éƒ¨
                trainingLogs.scrollTop = trainingLogs.scrollHeight;
            }
            
            // è®­ç»ƒçŠ¶æ€è½®è¯¢
            let pollingInterval = null;
            
            // ç«‹å³å¼€å§‹æ£€æŸ¥è®­ç»ƒçŠ¶æ€
            checkTrainingStatus();
            
            // å®šæ—¶æ£€æŸ¥è®­ç»ƒçŠ¶æ€
            pollingInterval = setInterval(checkTrainingStatus, 2000);
            
            function checkTrainingStatus() {
                fetch('/api/training_status')
                    .then(response => response.json())
                    .then(data => {
                        updateUIWithTrainingStatus(data);
                    })
                    .catch(error => {
                        console.error('è·å–è®­ç»ƒçŠ¶æ€å¤±è´¥:', error);
                    });
            }
            
            function updateUIWithTrainingStatus(data) {
                const { training_in_progress, status, logs } = data;
                
                // å¦‚æœè®­ç»ƒå·²ç»å¼€å§‹ï¼Œç¡®ä¿ä½¿ç”¨ä¸åç«¯ä¸€è‡´çš„å‚æ•°
                if (training_in_progress && status.total_epochs > 0) {
                    // æ›´æ–°epochsæ˜¾ç¤ºä»¥åŒ¹é…åç«¯å®é™…ä½¿ç”¨çš„è½®æ•°
                    if (status.total_epochs !== trainingParams.epochs) {
                        trainingParams.epochs = status.total_epochs;
                        updateParamDisplay();
                    }
                }
                
                // æ›´æ–°è®­ç»ƒçŠ¶æ€æ–‡æœ¬å’Œæ ·å¼
                if (status.status === 'training') {
                    trainingStatus.textContent = status.message;
                    trainingStatus.className = 'training-status status-training';
                    startTrainingBtn.disabled = true;
                    stopTrainingBtn.style.display = 'inline-block';
                    retrainBtn.style.display = 'none';
                } else if (status.status === 'completed') {
                    trainingStatus.textContent = status.message;
                    trainingStatus.className = 'training-status status-completed';
                    startTrainingBtn.style.display = 'none';
                    stopTrainingBtn.style.display = 'none';
                    viewResultsBtn.style.display = 'inline-block';
                    retrainBtn.style.display = 'inline-block';
                    
                    // æ¸…é™¤è½®è¯¢
                    if (pollingInterval) {
                        clearInterval(pollingInterval);
                        pollingInterval = null;
                    }
                } else if (status.status === 'stopped') {
                    trainingStatus.textContent = status.message;
                    trainingStatus.className = 'training-status status-stopped';
                    startTrainingBtn.style.display = 'none';
                    stopTrainingBtn.style.display = 'none';
                    retrainBtn.style.display = 'none';
                    viewResultsBtn.style.display = 'none';
                    stopOptions.style.display = 'block';
                } else if (status.status === 'error') {
                    trainingStatus.textContent = status.message;
                    trainingStatus.className = 'training-status status-error';
                    startTrainingBtn.disabled = false;
                    stopTrainingBtn.style.display = 'none';
                    stopOptions.style.display = 'none';
                } else if (!training_in_progress) {
                    trainingStatus.textContent = 'â³ ç­‰å¾…å¼€å§‹è®­ç»ƒ...';
                    trainingStatus.className = 'training-status status-pending';
                    startTrainingBtn.disabled = false;
                    stopTrainingBtn.style.display = 'none';
                }
                
                // æ›´æ–°è¿›åº¦æ¡
                if (status.total_epochs > 0) {
                    // è®¡ç®—æ€»ä½“è¿›åº¦ç™¾åˆ†æ¯”
                    const totalProgress = Math.min(100, Math.round((status.current_epoch / status.total_epochs) * 100));
                    
                    progressBar.style.width = totalProgress + '%';
                    progressBar.setAttribute('aria-valuenow', totalProgress);
                    progressBar.textContent = totalProgress.toFixed(0) + '%';
                    
                    // æ›´æ–°å½“å‰è½®æ¬¡ä¿¡æ¯
                    currentEpoch.textContent = status.current_epoch;
                    
                    // æ›´æ–°æŸå¤±å€¼å’Œå‡†ç¡®ç‡
                    if (status.train_loss !== undefined) {
                        trainLoss.textContent = status.train_loss.toFixed(4);
                    }
                    if (status.train_accuracy !== undefined) {
                        trainAcc.textContent = status.train_accuracy.toFixed(2) + '%';
                    }
                    if (status.test_accuracy !== undefined) {
                        testAcc.textContent = status.test_accuracy.toFixed(2) + '%';
                    }
                }
                
                // æ›´æ–°æ—¥å¿—
                if (logs && logs.length > 0) {
                    // å­˜å‚¨å½“å‰å·²æœ‰çš„æ—¥å¿—å†…å®¹ï¼Œç”¨äºå»é‡
                    const existingLogs = new Set();
                    Array.from(trainingLogs.children).forEach(child => {
                        existingLogs.add(child.textContent);
                    });
                    
                    // åªæ·»åŠ æ–°çš„æ—¥å¿—ï¼Œé¿å…é‡å¤
                    logs.forEach(log => {
                        // åˆ›å»ºæ—¥å¿—æ¶ˆæ¯æ–‡æœ¬
                        const logMessage = log;
                        // æ£€æŸ¥æ˜¯å¦å·²ç»å­˜åœ¨ç›¸åŒå†…å®¹çš„æ—¥å¿—
                        const logExists = Array.from(trainingLogs.children).some(child => 
                            child.textContent.includes(logMessage)
                        );
                        if (!logExists) {
                            // ç”±äºæœåŠ¡å™¨è¿”å›çš„æ˜¯å­—ç¬¦ä¸²æ—¥å¿—ï¼Œæˆ‘ä»¬å°†å…¶ä½œä¸ºæ™®é€šä¿¡æ¯æ—¥å¿—æ·»åŠ 
                            addLog('info', logMessage);
                        }
                    });
                }
            }
            
            // è¡¨å•æäº¤äº‹ä»¶
            trainingForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // ç¦ç”¨å¼€å§‹æŒ‰é’®
                startTrainingBtn.disabled = true;
                stopTrainingBtn.style.display = 'inline-block';
                
                // åˆ›å»ºéšè—å­—æ®µæ¥ä¼ é€’å‚æ•°
                const paramsInput = document.createElement('input');
                paramsInput.type = 'hidden';
                paramsInput.name = 'training_params';
                paramsInput.value = JSON.stringify(trainingParams);
                trainingForm.appendChild(paramsInput);
                
                // æäº¤è¡¨å•
                trainingForm.submit();
            });
            
            // æŸ¥çœ‹ç»“æœæŒ‰é’®ç‚¹å‡»äº‹ä»¶
            viewResultsBtn.addEventListener('click', function() {
                window.location.href = '/results';
            });
            
            // é‡æ–°è®­ç»ƒæŒ‰é’®ç‚¹å‡»äº‹ä»¶
            retrainBtn.addEventListener('click', function() {
                // é‡ç½®è®­ç»ƒçŠ¶æ€
                trainingStatus.textContent = 'â³ å‡†å¤‡é‡æ–°è®­ç»ƒ...';
                trainingStatus.className = 'training-status status-pending';
                retrainBtn.style.display = 'none';
                viewResultsBtn.style.display = 'none';
                progressBar.style.width = '0%';
                progressBar.textContent = '0%';
                currentEpoch.textContent = '0';
                trainLoss.textContent = '0.0000';
                trainAcc.textContent = '0.00%';
                testAcc.textContent = '0.00%';
                
                // æ·»åŠ é‡æ–°è®­ç»ƒæ—¥å¿—
                addLog('info', 'å‡†å¤‡é‡æ–°å¼€å§‹è®­ç»ƒ...');
                
                // æ¨¡æ‹Ÿè¡¨å•æäº¤
                trainingForm.submit();
            });
            
            // åœæ­¢è®­ç»ƒæŒ‰é’®ç‚¹å‡»äº‹ä»¶
            stopTrainingBtn.addEventListener('click', function() {
                if (confirm('ç¡®å®šè¦åœæ­¢è®­ç»ƒå—ï¼Ÿè¿™å°†ä¸­æ–­å½“å‰çš„è®­ç»ƒè¿‡ç¨‹ï¼Œå¹¶ä¿å­˜å½“å‰æ¨¡å‹çŠ¶æ€ã€‚')) {
                    // è°ƒç”¨APIåœæ­¢è®­ç»ƒ
                    fetch('/api/stop_training', {
                        method: 'POST'
                    })
                    .then(response => response.json())
                    .then(data => {
                        addLog('info', 'åœæ­¢è®­ç»ƒè¯·æ±‚å·²å‘é€');
                    })
                    .catch(error => {
                        addLog('error', 'åœæ­¢è®­ç»ƒè¯·æ±‚å¤±è´¥');
                    });
                }
            });
            
            // ç»§ç»­è®­ç»ƒæŒ‰é’®ç‚¹å‡»äº‹ä»¶
            resumeTrainingBtn.addEventListener('click', function() {
                if (confirm('ç¡®å®šè¦ç»§ç»­è®­ç»ƒå—ï¼Ÿè¿™å°†ä»ä¸Šæ¬¡åœæ­¢çš„ä½ç½®ç»§ç»­ã€‚')) {
                    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                    this.textContent = 'å‡†å¤‡ä¸­...';
                    this.disabled = true;
                    
                    // éšè—åœæ­¢é€‰é¡¹ï¼Œæ˜¾ç¤ºè®­ç»ƒæŒ‰é’®
                    stopOptions.style.display = 'none';
                    stopTrainingBtn.style.display = 'inline-block';
                    trainingStatus.textContent = 'â³ å‡†å¤‡ç»§ç»­è®­ç»ƒ...';
                    trainingStatus.className = 'training-status status-pending';
                    
                    // å‘é€ç»§ç»­è®­ç»ƒè¯·æ±‚
                    fetch('/api/resume_training', {
                        method: 'POST'
                    })
                    .then(response => response.json())
                    .then(data => {
                        addLog('info', 'ç»§ç»­è®­ç»ƒè¯·æ±‚å·²å‘é€');
                    })
                    .catch(error => {
                        addLog('error', 'ç»§ç»­è®­ç»ƒè¯·æ±‚å¤±è´¥');
                        // æ¢å¤æ˜¾ç¤ºåœæ­¢é€‰é¡¹
                        stopOptions.style.display = 'block';
                        stopTrainingBtn.style.display = 'none';
                        this.textContent = 'ç»§ç»­è®­ç»ƒ';
                        this.disabled = false;
                    });
                }
            });
            
            // è¿”å›é…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            backToConfigBtn.addEventListener('click', function() {
                if (confirm('ç¡®å®šè¦è¿”å›é…ç½®é¡µé¢å—ï¼Ÿå½“å‰æœªä¿å­˜çš„è®­ç»ƒçŠ¶æ€å°†è¢«ä¿ç•™ï¼Œä½†ä¸ä¼šç«‹å³åº”ç”¨ã€‚')) {
                    window.location.href = '/config';
                }
            });
            
            // ç»ˆæ­¢è®­ç»ƒæŒ‰é’®ç‚¹å‡»äº‹ä»¶
            terminateTrainingBtn.addEventListener('click', function() {
                if (confirm('ç¡®å®šè¦ç»ˆæ­¢è®­ç»ƒå¹¶ä¿å­˜å½“å‰æ¨¡å‹å—ï¼Ÿè¿™å°†å®Œæˆè®­ç»ƒè¿‡ç¨‹å¹¶å¯ç«‹å³æŸ¥çœ‹ç»“æœã€‚')) {
                    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                    this.textContent = 'ä¿å­˜ä¸­...';
                    this.disabled = true;
                    
                    // æ ‡è®°è®­ç»ƒä¸ºå·²ç»ˆæ­¢
                    fetch('/api/terminate_training', {
                        method: 'POST'
                    })
                    .then(response => response.json())
                    .then(data => {
                        // è·³è½¬åˆ°ç»“æœé¡µé¢
                        window.location.href = '/results';
                    })
                    .catch(error => {
                        addLog('error', 'ç»ˆæ­¢è®­ç»ƒè¯·æ±‚å¤±è´¥');
                        this.textContent = 'ç»ˆæ­¢è®­ç»ƒ';
                        this.disabled = false;
                    });
                }
            });
        });
    </script>
</body>
</html>